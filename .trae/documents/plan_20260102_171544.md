# 阶段3：后端核心功能开发计划

## 1. 项目初始化

### 1.1 初始化项目结构
- 创建后端目录结构
- 配置依赖管理（requirements.txt）
- 初始化FastAPI应用

### 1.2 核心配置与工具
- 数据库连接配置
- JWT配置
- RSA密钥生成工具
- 日志配置

## 2. 数据库模型开发

### 2.1 模型定义
- Product模型（产品）
- License模型（授权卡密）
- Client模型（客户端实例）
- AdminUser模型（管理员）
- AuditLog模型（审计日志）

### 2.2 数据迁移
- 配置Alembic
- 生成初始迁移脚本

## 3. Admin Module开发

### 3.1 认证机制
- JWT登录认证
- 密码加密（bcrypt）
- 权限中间件

### 3.2 产品管理API
- 创建产品
- 查询产品列表
- 查询单个产品
- 更新产品
- 删除产品

### 3.3 授权管理API
- 创建授权
- 查询授权列表
- 查询单个授权
- 更新授权
- 吊销授权

### 3.4 实例管理API
- 查询客户端实例列表
- 查询单个实例
- 禁用实例

### 3.5 审计日志API
- 查询审计日志

## 4. License API开发

### 4.1 激活API
- 验证授权码
- 绑定客户端指纹
- 生成License Token
- 返回激活结果

### 4.2 心跳API
- 验证Token
- 更新最后心跳时间
- 返回心跳结果

### 4.3 状态API
- 验证Token
- 返回授权状态

## 5. 安全机制实现

### 5.1 RSA非对称加密
- RSA密钥生成与管理
- License Token签名与验证

### 5.2 授权逻辑
- 激活验证逻辑
- 心跳验证逻辑
- 授权吊销逻辑

### 5.3 审计日志
- 记录所有关键操作
- 支持查询与追溯

## 6. 开发规范与注意事项

### 6.1 代码规范
- 遵循PEP 8
- 使用类型注解
- 编写文档字符串

### 6.2 安全规范
- 授权逻辑全部在服务端实现
- 客户端仅存公钥
- 敏感数据加密存储
- 防止SQL注入

### 6.3 API设计
- Admin API与License API物理隔离
- RESTful API设计
- 统一错误处理
- 输入验证

## 7. 测试与验证

### 7.1 单元测试
- 模型测试
- 服务测试
- API测试

### 7.2 集成测试
- 数据库连接测试
- 认证流程测试
- 授权流程测试

## 8. 交付物

- 后端代码
- API文档
- 安全机制实现
- 测试报告